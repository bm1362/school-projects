<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <script src="JavaScript/modernizr-1.7.min.js"></script>
    <script type="text/javascript" src="JavaScript/Three.js"></script> <! 3d Engine created by MrDoob >
    <script type="text/javascript" src="JavaScript/ThreeExtras.js"></script>
    <script type="text/javascript" src="JavaScript/Stats.js"></script> <! //Prints FPS output, author unknown, source: github.com/mrdoob>
    <script type="text/javascript" src="JavaScript/Sphere.js"></script>
    <script type="text/javascript" src="JavaScript/Icosahedron.js"></script>
  <title>Using WebGL</title>
  </head>
  <body onload="init();" bgcolor="#000000">
  <div id="viewport" style=" 
        border: 0px solid black; 
        font-family: 'Ubuntu', sans-serif, sarif;
        font-size: 14px; 
        color: #fff; 
        background-color: #000000; 
        text-decoration: none; " ></div>
        
  <span id="out"></span>
  </body>
  </html>

<script type="text/javascript">
{
	//window variables
	if(!Modernizr.canvas | !Modernizr.webgl)
	   document.getElementById("out").innerHTML = "Your browser does not support HTML5/WebGL";
	else {
	   
    var canvasWidth = window.innerWidth;
    var canvasHeight = window.innerHeight - 200;
    var windowHalfX = canvasWidth/2;
    var windowHalfY = canvasHeight/2;

    //scene variables
    //var eq, zT, multX = 5, multY = 5, multZ = .5; //zT = the equation generated by anonymous function call.
    var mouseX = 0, mouseY = 0;
    var camera, scene, renderer;
	
	var sphere, plane;
	var dirLight, ambientLight;
	var mesh;
    //camera variables
    var upperBoundX, upperBoundY, lowerBoundX, lowerBoundY;
    upperBoundX = upperBoundY = 25;
    lowerBoundX = lowerBoundY = -25;
   
    setInterval( loop, 1000 / 60 );

    function init() 
    {
		//create div and append
		viewport = document.getElementById('viewport');
		container = document.createElement('div');
		viewport.appendChild(container);
		
		//init camera
        camera = new THREE.Camera( 75, canvasWidth / canvasHeight, 1, 10000 );
	    camera.focus = 5;
		camera.position.x =  1;
		camera.position.y = 1;
	    camera.position.z = 500;
		camera.updateMatrix();
        
        scene = new THREE.Scene();
		
		ambientLight = new THREE.AmbientLight( 0x444444 );
		scene.addLight( ambientLight );
		
 		pointLight = new THREE.PointLight( 0xffffff );
		pointLight.position.z = 400;
 		scene.addLight( pointLight );
 
		directionalLight = new THREE.DirectionalLight( 0xffffff );
		directionalLight.position.x = 10;
		directionalLight.position.y = 10;
		directionalLight.position.z = - 10;
		directionalLight.position.normalize();
		scene.addLight( directionalLight );
	    //drawOrigin();
		
		material = new THREE.MeshBasicMaterial( { map: ImageUtils.loadTexture( 'map_night.jpg' ) });
	    var geom = new Sphere( 300, 50, 50);
	    addMesh( geom, 0, 0, 0, material);

		//create renderer
        renderer = new THREE.WebGLRenderer();
        renderer.setSize( canvasWidth, canvasHeight );
        container.appendChild( renderer.domElement );
		
		//stats for fps testing
		stats = new Stats();
		stats.domElement.style.position = 'absolute';
		stats.domElement.style.top = '0px';
		container.appendChild( stats.domElement );
		
		//eventListener for mouse movement
	    container.addEventListener('mousemove', onDocumentMouseMove, false);

    }

    function loop() 
    {   
 	    rotate();
        renderer.render( scene, camera );
		stats.update();
	    outputToConsole();
		camera.updateMatrix();
    }
	
	//addMesh function
	function addMesh( geometry, x, y, z, material ) 
	{	
        mesh = new THREE.Mesh( geometry, material );
		mesh.position.x = x;
		mesh.position.y = y;
		mesh.position.z = z;
		mesh.rotation.x = 0;
		mesh.rotation.y = 0;
		mesh.rotation.z = 0;
		mesh.overdraw = true;
		mesh.updateMatrix();
		scene.addObject(mesh);			
	}
			
    function onDocumentMouseMove(event) 
    {		
       mouseX = event.clientX - windowHalfX;
       mouseY = event.clientY - windowHalfY;
    }

    function rotate()
    {
	  mesh.rotation.x -= (mouseY*.01 - mesh.rotation.x ) *.005;
	  mesh.rotation.y += (mouseX*.01 - mesh.rotation.y ) *.005;
	  mesh.rotation.z += 0//5;
	  
    }
	
    function drawOrigin()
    {
      // need to reimplement
    }

   function outputToConsole()
   {
      var outString = "Mouse: (" + mouseX + ", " + mouseY + ") Camera: (" + Math.floor(camera.position.x) + ", " + Math.floor(camera.position.y) +", " + Math.floor(camera.position.z) + ")<br>";
      document.getElementById("out").innerHTML = outString;
   }

}
}
</script>
